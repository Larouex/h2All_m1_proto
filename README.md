# H2All M1 Proto

A Next.js application for tracking environmental impact and managing carbon offset campaigns with PostgreSQL database.

## 🚀 Quick Start

### Local Development

1. **Clone and Install**:

   ```bash
   git clone <repository-url>
   cd H2All_m1_proto
   npm install
   ```

2. **Database Setup**:

   ```bash
   # Set up your local PostgreSQL database
   # Copy .env.local.example to .env.local and configure
   npm run db:push
   ```

3. **Run Development Server**:
   ```bash
   npm run dev
   ```

### Railway Deployment 🚂

Deploy to Railway with PostgreSQL database:

1. **Prepare for Deployment**:

   ```bash
   ./scripts/prepare-railway.sh
   ```

2. **Deploy to Railway**:

   - Visit [railway.app](https://railway.app)
   - Deploy from GitHub repository
   - Add PostgreSQL service
   - Set environment variables (see `.env.railway`)

3. **Detailed Instructions**:
   - 📖 [Railway Deployment Guide](./RAILWAY_DEPLOYMENT.md)
   - ✅ [Deployment Checklist](./RAILWAY_CHECKLIST.md)

## 🏗️ Architecture

### Services (Railway Deployment)

```
┌─────────────────┐    ┌──────────────────┐
│   Web Service   │────▶  PostgreSQL      │
│   (Next.js)     │    │   Database       │
│   - Frontend    │    │                  │
│   - API Routes  │    │                  │
└─────────────────┘    └──────────────────┘
```

### Key Components

- **Frontend**: Next.js with React and Bootstrap
- **Backend**: Next.js API routes
- **Database**: PostgreSQL with Drizzle ORM
- **Authentication**: JWT-based authentication
- **Deployment**: Railway platform

## 📁 Project Structure

```
├── app/                    # Next.js app directory
│   ├── api/               # API routes
│   ├── components/        # React components
│   └── lib/              # Utility libraries
├── db/                    # Database schema and migrations
├── public/               # Static assets
├── scripts/              # Deployment scripts
├── railway.yml           # Railway configuration
├── railway.json          # Railway deployment settings
└── RAILWAY_*.md          # Railway documentation
```

## 🔧 Environment Variables

### Development (.env.local)

```bash
DB_HOST=localhost
DB_PORT=5432
DB_USER=your_user
DB_PASSWORD=your_password
DB_NAME=h2all_m1_proto
JWT_SECRET=your-jwt-secret
```

### Production (Railway)

```bash
DATABASE_URL=postgresql://...  # Auto-generated by Railway
JWT_SECRET=your-production-jwt-secret
NODE_ENV=production
```

## 📊 API Endpoints

### Core Endpoints

- `GET /api/health` - Health check and database status
- `GET /api/campaigns` - List campaigns
- `POST /api/campaigns` - Create campaign (admin)
- `GET /api/redemption-codes` - List redemption codes
- `POST /api/subscribe` - Email subscription

### Authentication

- `POST /api/auth/login` - User login
- `POST /api/auth/register` - User registration
- `GET /api/auth/me` - Current user info

### Admin

- `POST /api/admin/promote-user` - Promote user to admin
- `POST /api/admin/generate-redeem-url` - Generate redemption URLs

## 🗄️ Database Schema

- **users** - User accounts and authentication
- **campaigns** - Carbon offset campaigns
- **redemption_codes** - Campaign redemption codes
- **projects** - Environmental projects
- **subscriptions** - Email subscriptions

## 🧪 Testing

```bash
# Run tests
npm run test

# Health check
curl http://localhost:3000/api/health

# API documentation
open http://localhost:3000/api/swagger
```

## 🚢 Deployment Options

### Railway (Recommended)

- One-click deployment from GitHub
- Automatic PostgreSQL provisioning
- Built-in monitoring and scaling
- See [Railway Deployment Guide](./RAILWAY_DEPLOYMENT.md)

### Other Platforms

- **Vercel**: Frontend + Serverless functions
- **Heroku**: Full-stack deployment
- **DigitalOcean**: VPS deployment
- **AWS**: ECS or Lambda deployment

## 📚 Documentation

- [Railway Deployment Guide](./RAILWAY_DEPLOYMENT.md)
- [Railway Deployment Checklist](./RAILWAY_CHECKLIST.md)
- [API Documentation](http://localhost:3000/api/swagger)

## 🤝 Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Test locally
5. Submit a pull request

## 📄 License

This project is licensed under the MIT License.

## 🆘 Support

- **Railway Issues**: Check [Railway Documentation](https://docs.railway.app)
- **Application Issues**: Open a GitHub issue
- **General Questions**: Contact the development team
