# Copilot Instructions for H2All M1 Project

You are an expert AI programmer specializing in Next.js, TypeScript, and Azure Static Web Apps. We are building a new project called "H2All M1".

## CRITICAL: Project Structure & Build Commands

### Directory Structure

- **Repository Root**: `/Users/larrywjordanjr/Projects/H2All_m1_proto`
- **Next.js Application**: `/Users/larrywjordanjr/Projects/H2All_m1_proto/h2all-m1`

### MANDATORY: Always Work in h2all-m1 Directory

The actual Next.js application is in the `h2all-m1` subdirectory, NOT the repository root.

### Build and Development Commands

```bash
# Development Server
cd /Users/larrywjordanjr/Projects/H2All_m1_proto/h2all-m1
npm run dev

# Build for Production
cd /Users/larrywjordanjr/Projects/H2All_m1_proto/h2all-m1
npm run build

# Install Dependencies (use legacy-peer-deps for React 19 compatibility)
cd /Users/larrywjordanjr/Projects/H2All_m1_proto/h2all-m1
npm install --legacy-peer-deps

# Clear Cache if needed
cd /Users/larrywjordanjr/Projects/H2All_m1_proto/h2all-m1
rm -rf .next node_modules package-lock.json
npm install --legacy-peer-deps
```

### Application URLs

- **Home**: http://localhost:3000
- **Admin Dashboard**: http://localhost:3000/admin
- **Code Management**: http://localhost:3000/admin/codes
- **API Documentation**: http://localhost:3000/api-docs

## Project Requirements

- **Framework**: Next.js 15.4.5 (App Router)
- **Language**: TypeScript
- **React**: 19.1.0
- **Styling**: React Bootstrap 2.10.10 and Bootstrap 5
- **Database**: Azure Table Storage
- **Code Generation**: nanoid for secure unique codes

## Coding Rules

1. All components must be functional components using React Hooks.
2. All code must be strictly typed with TypeScript.
3. Ensure all UI components are mobile-responsive using React Bootstrap's grid system (Container, Row, Col).
4. Use the standard project structure: `/src/app`, `/src/components`, etc.
5. **CLIENT-SIDE ONLY**: All React components and pages must be client-side rendered. Add `"use client";` directive at the top of every component file and page file.

## CRITICAL ERROR PREVENTION RULES - DO NOT REPEAT THESE MISTAKES

### 1. Directory Navigation & Commands

- **ALWAYS** change to `/Users/larrywjordanjr/Projects/H2All_m1_proto/h2all-m1` before running npm commands
- **NEVER** run npm commands from the repository root `/Users/larrywjordanjr/Projects/H2All_m1_proto`
- **ALWAYS** verify you're in the correct directory with `pwd` before running commands
- If you get "Missing script" errors, you're in the wrong directory

### 2. Dependency Management

- **ALWAYS** use `--legacy-peer-deps` flag when installing packages due to React 19 compatibility issues
- If you encounter dependency conflicts with swagger-ui-react, use legacy peer deps
- **NEVER** ignore lockfile warnings - remove extra lockfiles from parent directories

### 3. Next.js Development Server Issues

- If you get "Couldn't find any pages or app directory" error:
  1. Verify you're in the h2all-m1 directory
  2. Clear Next.js cache: `rm -rf .next`
  3. Reinstall dependencies with `--legacy-peer-deps`
- The src/app directory structure is correct - the issue is usually wrong working directory

### 4. Terminal Command Execution

- **NEVER** run multiple terminal commands in parallel that might conflict
- **ALWAYS** wait for one command to complete before running the next
- **NEVER** assume the working directory - always check first

### 5. Error Diagnosis & Fixing

- **ALWAYS** run a full build (`npm run build`) to get accurate error reporting
- If accessibility/lint errors persist, restart the dev server and clear caches
- TypeScript errors take precedence over accessibility warnings

## Technology Stack Details

- **Frontend**: Next.js 15.4.5, TypeScript, React Bootstrap
- **API**: Next.js API routes with Swagger documentation
- **Database**: Azure Table Storage with proper entity modeling
- **Authentication**: Custom user management system
- **Code Generation**: Cryptographically secure with nanoid
- **URL Parsing**: Custom redemption URL parser utilities
- Check for environment variable conflicts that might cause unexpected behavior

### 8. Git and GitHub Operations

- **ONLY** perform git operations (init, add, commit, push) when explicitly requested by the user
- **NEVER** automatically commit, push, or check code into git/GitHub without explicit user instruction
- **ALWAYS** ask for confirmation before performing any git operations unless the user specifically requested them
- **FOCUS** on code development and testing first - git operations are separate tasks
